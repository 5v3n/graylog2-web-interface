<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
  <title>Dashboard</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <%= stylesheet_link_tag "reset" %>
  <%= stylesheet_link_tag "dashboard" %>
  <%= stylesheet_link_tag "messages" %>
  <%= javascript_include_tag "jquery-1.4.2.min" %>
  <%= javascript_include_tag "dashboard" %>

  <script type="text/javascript">
    ws = new WebSocket("ws://127.0.0.1:8080");
    ws.onmessage = function(evt) { alert("got message: " + evt.data) };
    ws.onclose = function() { alert("socket closed"); };
    ws.onopen = function() {
      var request = Array;
      request['status'] = '<%= ActiveSupport::JSON::encode({ :type => "status" }) %>';
      request['lastmessage'] = '<%= ActiveSupport::JSON::encode({ :type => "lastmessage" }) %>';
      request['messagecount'] = '<%= ActiveSupport::JSON::encode({
            :type => "messagecount",
            :interval => Setting.get_message_count_interval(current_user),
            :maximum => Setting.get_message_max_count(current_user)}) %>';
      ws.send(request['messagecount']);
    };
  </script>
</head>
<body>

  <% message_count_interval = Setting.get_message_count_interval(current_user) %>

  <div id="top">
    <% if File.exist?(RAILS_ROOT + "/public/images/dashboard_logo.png") %>
        <%= image_tag('dashboard_logo.png') %>
    <% end %>
    <div id="top-timestamp">
      <%= Time.now %>
    </div>
  </div>

  <div id="statuscontainer" class="status-<%=h Message.count_of_last_minutes(message_count_interval) > Setting.get_message_max_count(current_user) ? 'problems' : 'okay' %>">
    <div id="status">
      <h1><%= Message.count_of_last_minutes(message_count_interval) %> messages / <%=h message_count_interval %> minutes</h1>
    </div>
  </div>

  <div id="content">
    <%= yield %>
  </div>

</body>
</html>